### 读512MB大小文件效率分析

![](/static/images/2204/p003.png)

上图所示内容是从磁盘读512MB的文件，写入/dev/null中

一些值得注意的点：

- 测试用的文件系统是ext4，磁盘块长度是4KB（磁盘块长度由st_blksize表示）
  - 所以当BUFFSIZE超过4096之后，继续增加缓冲区长度，系统CPU时间就不会更好了
- 因为文件系统为了改善读性能，会采用预读技术（read ahead），当检测到正在进行顺序读时，系统会读取比应用要求更多的数据，并假想应用会很快读到这些数据。
  - 所以当缓存区长度小至32字节时的时钟时间，与拥有较大缓冲区长度的时钟时间几乎一样
- 重复运行本程序，可能会得到更好的计时。因为操作系统试图用告诉缓存技术将文件防止在内存中，第一次从磁盘读取文件之后，会缓存到内存中，后续各次运行一般就直接系统告诉缓存访问文件，无需读磁盘。
  - 上述测试的输入文件每次必须是不同的
  - 备注：测试系统配置了6GB RAM


## 参考

- UNIX环境高级编程，3.9
