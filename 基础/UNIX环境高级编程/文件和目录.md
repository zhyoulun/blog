## 文件类型

文件类型包括如下几种：

- 普通文件
- 目录文件
- 块特殊文件
- 字符特殊文件
- FIFO
- 套接字
- 符号链接


```c
#include <stdio.h>
#include <sys/stat.h>


int main(int argc, char *argv[]) {
    int i;
    struct stat buf;
    char *ptr;
    for (i = 1; i < argc; i++) {
        printf("%s: ", argv[i]);
        if (lstat(argv[i], &buf) < 0) {
            perror("lstat error");
            continue;
        }
        if (S_ISREG(buf.st_mode)) {
            ptr = "regular";
        } else if (S_ISDIR(buf.st_mode)) {
            ptr = "directory";
        } else if (S_ISCHR(buf.st_mode)) {
            ptr = "character special";
        } else if (S_ISFIFO(buf.st_mode)) {
            ptr = "fifo";
        } else if (S_ISLNK(buf.st_mode)) {
            ptr = "symbolic link";
        } else if (S_ISSOCK(buf.st_mode)) {
            ptr = "socket";
        } else {
            ptr = "unknown mode";
        }
        printf("%s\n", ptr);
    }
    return 0;
}
```

运行

```
$ ./temp/file-type /etc/passwd /etc /dev/log /dev/tty
/etc/passwd: regular
/etc: directory
/dev/log: symbolic link
/dev/tty: character special
```

## 文件访问权限

st_mode值也包含了对we你按的访问权限位。当提及文件时，指的是前面所提到的任何类型的文件。所有文件类型（目录、字符特别文件等）都有访问权限（access permission）。

每个文件有9个访问权限位，可分为三类：

![](/static/images/2006/p039.png)

- 第一个规则是，我们用名字打开任一类型的文件时，对该名字中包含的每一个目录，包括它可能隐含的当前工作目录，都应具有执行权限。
  - 这就是为什么对于目录其执行权限位常被称为搜索位的原因
- 对于一个文件的读权限，决定了我们是否能够打开现有文件进行读操作。这与open函数的O_RDONLY和O_RDWR标志有关
- 对于一个文件的写权限，决定了我们是否能够打开现有文件进行写操作。这与open函数的O_WRONLY和O_RDWR标志有关
- 为了在open函数中对一个文件执行O_TRUNC标志，必须对该文件具有写权限
- 为了在一个目录中创建一个新文件，必须对该目录具有写权限和执行权限
- 为了删除一个现有文件，必须对包含该文件的目录具有写权限和执行权限。对于该文件本身则不需要有读、写权限
- 如果用7个exec函数中任意一个执行某个文件，都必须对该文件具有执行权限。该文件还必须是一个普通文件