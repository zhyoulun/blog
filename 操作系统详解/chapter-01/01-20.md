# 系统描述符类型

![](/static/images/2502/p011.png)

当段描述符中的 **S（描述符类型）标志** 为 0 时，描述符类型为系统描述符。处理器识别以下类型的系统描述符：
- **局部描述符表（LDT）段描述符**。
- **任务状态段（TSS）描述符**。
- **调用门描述符**。
- **中断门描述符**。
- **陷阱门描述符**。
- **任务门描述符**。

这些描述符类型分为两类：**系统段描述符** 和 **门描述符**。
- **系统段描述符** 指向系统段（LDT 和 TSS 段）。
- **门描述符** 本身是“门”，它们保存指向代码段中过程入口点的指针（调用门、中断门和陷阱门），或者保存 TSS 的段选择符（任务门）。

表 3-2 显示了系统段描述符和门描述符的类型字段编码。

---

### 更多信息
- 有关系统段描述符的更多信息，请参见第 3.5.1 节“段描述符表”和第 6.2.2 节“TSS 描述符”。
- 有关门描述符的更多信息，请参见第 4.8.3 节“调用门”、第 5.11 节“IDT 描述符”和第 6.2.4 节“任务门描述符”。

---

### 总结
- **S 标志为 0**：描述符为系统描述符。
- **系统描述符分类**：
  - 系统段描述符：指向 LDT 或 TSS 段。
  - 门描述符：保存代码段入口指针或 TSS 段选择符。

## Segment Descriptor Tables

![](/static/images/2502/p012.png)

段描述符表是段描述符的数组（参见上图）。描述符表的长度是可变的，最多可以包含8192（2^13）个8字节的描述符。描述符表有两种类型：

- 全局描述符表（GDT）
- 局部描述符表（LDT）

每个系统必须定义一个GDT，它可以用于系统中的所有程序和任务。可选地，可以定义一个或多个LDT。例如，可以为每个单独运行的任务定义一个LDT，或者某些或所有任务可以共享同一个LDT。

GDT本身不是一个段，而是线性地址空间中的一个数据结构。GDT的基线性地址和界限必须加载到GDTR寄存器中（参见第2.4节，“内存管理寄存器”）。GDT的基地址应该对齐到8字节边界，以获得最佳的处理器性能。GDT的界限值以字节表示。与段类似，界限值加上基地址可以得到最后一个有效字节的地址。界限值为0时，表示只有一个有效字节。由于段描述符始终是8字节长，GDT的界限值应始终比8的整数倍少1（即8N – 1）。

GDT中的第一个描述符不被处理器使用。指向这个“空描述符”的段选择子在被加载到数据段寄存器（DS、ES、FS或GS）时不会生成异常，但在尝试使用该描述符访问内存时，总是会生成一般保护异常（#GP）。通过使用这个段选择子初始化段寄存器，可以确保对未使用的段寄存器的意外引用会生成异常。

LDT位于LDT类型的系统段中。GDT必须包含LDT段的段描述符。如果系统支持多个LDT，每个LDT在GDT中必须有一个单独的段选择子和段描述符。LDT的段描述符可以位于GDT中的任何位置。有关LDT段描述符类型的信息，请参见第3.5节，“系统描述符类型”。

LDT通过其段选择子访问。为了在访问LDT时消除地址转换，LDT的段选择子、基线性地址、界限和访问权限存储在LDTR寄存器中（参见第2.4节，“内存管理寄存器”）。

当存储GDTR寄存器时（使用SGDT指令），一个48位的“伪描述符”会被存储在内存中（参见下图）。为了避免用户模式（特权级3）中的对齐检查故障，伪描述符应位于奇数字地址（即地址MOD 4等于2）。这会导致处理器存储一个对齐的字，然后是一个对齐的双字。用户模式程序通常不会存储伪描述符，但通过这种方式对齐伪描述符可以避免生成对齐检查故障的可能性。在使用SIDT指令存储IDTR寄存器时，也应使用相同的对齐方式。

当存储LDTR或任务寄存器时（分别使用SLTR或STR指令），伪描述符应位于双字地址（即地址MOD 4等于0）。

![](/static/images/2502/p013.png)