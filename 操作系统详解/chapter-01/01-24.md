# TRANSLATION LOOKASIDE BUFFERS (TLBS)

处理器将最近使用的页目录项和页表项存储在称为转换后备缓冲器（TLB）的片上缓存中。P6系列和Pentium处理器为数据缓存和指令缓存分别设置了独立的TLB。此外，P6系列处理器还为4KB和4MB页大小维护了独立的TLB。可以使用CPUID指令来确定P6系列和Pentium处理器中TLB的大小。

大多数分页操作使用TLB中的内容执行。只有当TLB中不包含请求页的转换信息时，才会对内存中的页目录和页表执行总线周期。

TLB对应用程序和任务（特权级大于0）是不可访问的；也就是说，它们无法使TLB无效。只有运行在特权级0的操作系统或执行程序才能使TLB或选定的TLB条目无效。每当页目录项或页表项被更改（包括将存在标志设置为0时），操作系统必须立即使TLB中的相应条目无效，以便在下一次引用该条目时可以更新。

每次加载CR3寄存器时，所有（非全局）TLB都会自动无效（除非页或页表项的G标志被设置，如本节后面所述）。CR3寄存器可以通过以下两种方式加载：
- **显式加载**，例如使用MOV指令：
  ```
  MOV CR3, EAX
  ```
  其中EAX寄存器包含适当的页目录基地址。
- **隐式加载**，通过执行任务切换，任务切换会自动更改CR3寄存器的内容。

INVLPG指令用于使TLB中的特定页表项无效。通常，该指令仅使单个TLB条目无效；但在某些情况下，它可能会使多个选定条目无效，甚至可能使所有TLB无效。该指令忽略页目录或页表项中G标志的设置（见下文）。

（在Pentium Pro处理器中引入。）CR4寄存器中的页全局启用（PGE）标志以及页目录或页表项的全局（G）标志（第8位）可用于防止频繁使用的页在任务切换或加载CR3寄存器时自动从TLB中无效。（有关全局标志的更多信息，请参见第3.7.6节“页目录和页表项”。）当处理器将全局页的页目录或页表项加载到TLB中时，该条目将无限期保留在TLB中。确定性使全局页条目无效的唯一方法如下：
- 清除PGE标志，然后使TLB无效。
- 执行INVLPG指令以使TLB中的单个页目录或页表项无效。

有关TLB无效化的更多信息，请参见第10.9节“使转换后备缓冲器（TLB）无效”。