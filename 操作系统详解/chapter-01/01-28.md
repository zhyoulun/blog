# LIMIT CHECKING

段描述符的限长字段防止程序或过程访问段外的内存位置。限长的有效值取决于G（粒度）标志的设置（参见图4-1）。对于数据段，限长还取决于E（扩展方向）标志和B（默认栈指针大小和/或上界）标志。当段描述符为数据段类型时，E标志是类型字段中的一位。当G标志清除（字节粒度）时，有效限长是段描述符中20位限长字段的值。此时，限长范围为0到FFFFFH（1MB）。当G标志设置（4KB页粒度）时，处理器将限长字段的值乘以2^12（4KB）。在这种情况下，有效限长范围为FFFH（4KB）到FFFFFFFFH（4GB）。请注意，当使用缩放时（G标志设置），段偏移量（地址）的低12位不会与限长进行检查；例如，如果段限长为0，偏移量0到FFFH仍然有效。

对于除向下扩展数据段之外的所有类型的段，有效限长是段中允许访问的最后一个地址，即段大小（以字节为单位）减一。每当尝试访问段中的以下地址时，处理器会引发一般保护异常：
- 偏移量大于有效限长的字节
- 偏移量大于（有效限长-1）的字
- 偏移量大于（有效限长-3）的双字
- 偏移量大于（有效限长-7）的四字

对于向下扩展数据段，段限长具有相同的功能但解释方式不同。在这里，有效限长指定段内不允许访问的最后一个地址；如果B标志设置，有效偏移量范围为（有效限长+1）到FFFFFFFFH；如果B标志清除，有效偏移量范围为（有效限长+1）到FFFFFH。当段限长为0时，向下扩展段具有最大大小。

限长检查可以捕获编程错误，如失控代码、失控下标和无效指针计算。这些错误在发生时被检测到，因此更容易识别原因。如果没有限长检查，这些错误可能会覆盖另一个段中的代码或数据。

除了检查段限长外，处理器还检查描述符表限长。GDTR和IDTR寄存器包含16位限长值，处理器使用这些值来防止程序选择各自描述符表之外的段描述符。LDTR和任务寄存器包含32位段限长值（分别从当前LDT和TSS的段描述符中读取）。处理器使用这些段限长来防止访问超出当前LDT和TSS的边界。有关GDT和LDT限长字段的更多信息，请参见第3.5.1节“段描述符表”；有关IDT限长字段的更多信息，请参见第5.10节“中断描述符表（IDT）”；有关TSS段限长字段的更多信息，请参见第6.2.3节“任务寄存器”。