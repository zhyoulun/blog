# PRIVILEGE LEVELS

![](/static/images/2502/p029.png)

处理器的段保护机制识别4个特权级别，编号从0到3。数字越大，特权越低。图4-2展示了这些特权级别如何被解释为保护环。

中心（保留给最高特权的代码、数据和栈）用于包含关键软件的段，通常是操作系统的内核。外环用于不太关键的软件。（如果系统仅使用4个可能特权级别中的2个，应使用级别0和3。）

处理器使用特权级别来防止在较低特权级别运行的程序或任务访问具有较高特权的段，除非在受控的情况下。当处理器检测到特权级别违规时，它会生成一般保护异常（#GP）。

为了在代码段和数据段之间执行特权级别检查，处理器识别以下三种特权级别：

- **当前特权级别（CPL）**：CPL是当前执行的程序或任务的特权级别。它存储在CS和SS段寄存器的第0和1位。通常，CPL等于从中获取指令的代码段的特权级别。当程序控制转移到具有不同特权级别的代码段时，处理器会更改CPL。在访问符合代码段时，CPL的处理略有不同。符合代码段可以从任何特权级别访问，只要该特权级别等于或大于（特权较低）符合代码段的DPL。此外，当处理器访问与CPL特权级别不同的符合代码段时，CPL不会更改。

- **描述符特权级别（DPL）**：DPL是段或门的特权级别。它存储在段或门的段或门描述符的DPL字段中。当当前执行的代码段尝试访问段或门时，段或门的DPL会与段或门选择子的CPL和RPL进行比较（如本节后面所述）。DPL的解释因访问的段或门类型而异：
  - **数据段**：DPL表示允许访问该段的程序或任务的最高特权级别。例如，如果数据段的DPL为1，则只有以CPL为0或1运行的程序才能访问该段。
  - **非符合代码段（不使用调用门）**：DPL表示程序或任务必须具有的特权级别才能访问该段。例如，如果非符合代码段的DPL为0，则只有以CPL为0运行的程序才能访问该段。
  - **调用门**：DPL表示当前执行的程序或任务可以具有的最高特权级别，并且仍然能够访问调用门。（这与数据段的访问规则相同。）
  - **符合代码段和通过调用门访问的非符合代码段**：DPL表示允许访问该段的程序或任务的最低特权级别。例如，如果符合代码段的DPL为2，则以CPL为0或1运行的程序无法访问该段。
  - **TSS**：DPL表示当前执行的程序或任务可以具有的最高特权级别，并且仍然能够访问TSS。（这与数据段的访问规则相同。）

- **请求特权级别（RPL）**：RPL是分配给段选择子的覆盖特权级别。它存储在段选择子的第0和1位。处理器会检查RPL和CPL，以确定是否允许访问段。即使请求访问段的程序或任务具有足够的特权来访问该段，如果RPL的特权级别不足，访问也会被拒绝。也就是说，如果段选择子的RPL数值上大于CPL，则RPL会覆盖CPL，反之亦然。RPL可用于确保特权代码不会代表应用程序访问段，除非程序本身具有该段的访问权限。有关RPL的目的和典型用途的详细描述，请参见第4.10.4节“检查调用者访问权限（ARPL指令）”。

当段描述符的段选择子加载到段寄存器中时，会进行特权级别检查。用于数据访问的检查与用于代码段之间程序控制转移的检查不同；因此，以下部分将分别考虑这两种访问。