# NONMASKABLE INTERRUPT (NMI)

### **5.7 不可屏蔽中断（NMI）**
不可屏蔽中断（NMI）可以通过以下两种方式生成：
- **外部硬件触发 NMI 引脚**。
- **处理器在系统总线（Pentium 4 和 Intel Xeon 处理器）或 APIC 串行总线（P6 系列和 Pentium 处理器）上接收到传递模式为 NMI 的消息**。

当处理器从上述任一来源接收到 NMI 时，它会立即调用由中断向量号 2 指向的 NMI 处理程序。处理器还会触发某些硬件条件，以确保在 NMI 处理程序执行完成之前不会接收到其他中断，包括 NMI 中断（参见第 5.7.1 节“处理多个 NMI”）。

此外，当从上述任一来源接收到 NMI 时，它不能被 EFLAGS 寄存器中的 IF 标志屏蔽。

可以通过 INTR 引脚向向量 2 发出可屏蔽硬件中断来调用 NMI 中断处理程序；然而，这种中断并不是真正的 NMI 中断。只有通过上述机制之一传递的中断才能激活处理器的 NMI 处理硬件，成为真正的 NMI 中断。

---

### **5.7.1 处理多个 NMI**
当 NMI 中断处理程序正在执行时，处理器会禁用对 NMI 处理程序的额外调用，直到执行下一条 IRET 指令。这种对后续 NMI 的阻塞防止了对 NMI 处理程序的多次调用。建议通过中断门访问 NMI 中断处理程序，以禁用可屏蔽硬件中断（参见第 5.8.1 节“屏蔽可屏蔽硬件中断”）。如果 NMI 处理程序是一个 IOPL 小于 3 的虚拟 8086 任务，则从处理程序中发出的 IRET 指令会生成一般保护异常（参见第 16.2.7 节“敏感指令”）。在这种情况下，NMI 会在调用一般保护异常处理程序之前解除屏蔽。
