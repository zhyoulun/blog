# ERROR CODE

当异常条件与特定段相关时，处理器会将错误代码压入异常处理程序（无论是过程还是任务）的堆栈中。错误代码的格式如图 5-6 所示。错误代码类似于段选择子；然而，错误代码不包含 **TI** 标志和 **RPL** 字段，而是包含 3 个标志：

- **EXT（外部事件，位 0）**：当设置为 1 时，表示程序外部的事件（例如硬件中断）导致了异常。  
- **IDT（描述符位置，位 1）**：当设置为 1 时，表示错误代码的索引部分引用 IDT 中的门描述符；当清除为 0 时，表示索引引用 GDT 或当前 LDT 中的描述符。  
- **TI（GDT/LDT，位 2）**：仅在 **IDT** 标志为 0 时使用。当设置为 1 时，**TI** 标志表示错误代码的索引部分引用 LDT 中的段或门描述符；当清除为 0 时，表示索引引用当前 GDT 中的描述符。

![](/static/images/2502/p050.png)

段选择子索引字段提供了对 IDT、GDT 或当前 LDT 中被错误代码引用的段或门选择子的索引。在某些情况下，错误代码为空（即低字中的所有位均为 0）。空错误代码表示错误不是由于引用特定段引起的，或者在操作中引用了空段描述符。

对于页错误异常（#PF），错误代码的格式不同，请参见本章中的“中断 14——页错误异常（#PF）”。

错误代码以双字或字（取决于默认的中断、陷阱或任务门大小）压入堆栈。为了保持堆栈对齐以进行双字压栈，错误代码的上半部分保留。请注意，当执行 **IRET** 指令从异常处理程序返回时，错误代码不会被弹出，因此处理程序必须在执行返回之前移除错误代码。

对于通过 **INTR** 或 **LINT[1:0]** 引脚外部生成的异常或 **INT n** 指令生成的异常，即使这些异常通常会生成错误代码，错误代码也不会被压入堆栈。