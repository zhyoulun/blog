# 8.10. APIC BUS MESSAGE PASSING MECHANISM AND PROTOCOL (P6 FAMILY AND PENTIUM PROCESSORS ONLY)

**Pentium 4 和 Intel Xeon 处理器** 在系统总线上通过系统总线消息传递机制和协议在本地 APIC 和 I/O APIC 之间传递消息。

**P6 家族和 Pentium 处理器** 在串行 APIC 总线上在本地 APIC 和 I/O APIC 之间传递消息，具体如下：由于 APIC 总线上一次只能发送一条消息，I/O APIC 和本地 APIC 采用“轮转优先级”仲裁协议来获得在 APIC 总线上发送消息的权限。一个或多个 APIC 可能同时开始发送它们的消息。在每条消息的开头，每个 APIC 都会在 APIC 总线上呈现它正在发送的消息类型及其当前的仲裁优先级。此信息用于仲裁。在每个仲裁周期（在一个仲裁轮次内）之后，只有潜在的获胜者继续驱动总线。当所有仲裁周期完成后，将只剩下一个 APIC 在驱动总线。一旦选出获胜者，它将获得总线的独占使用权，并继续驱动总线以发送其实际消息。

在每条消息成功传输后，所有 APIC 的仲裁优先级增加 1。之前的获胜者（即刚刚成功发送其消息的 APIC）将其优先级设置为 0（最低）。在仲裁期间仲裁优先级为 15（最高）但未发送消息的代理采用前一个获胜者的仲裁优先级，并增加 1。需要注意的是，如果其中一个 APIC 发出特殊的中断结束（EOI）消息，上述仲裁协议会略有不同。无论发送者的仲裁优先级如何，此高优先级消息都会被授予总线，除非多个 APIC 同时发出 EOI 消息。在后一种情况下，发送 EOI 消息的 APIC 使用它们的仲裁优先级进行仲裁。

如果 APIC 设置为使用“最低优先级”仲裁（见第 8.6.2.4 节“最低优先级传递模式”），并且多个 APIC 当前以最低优先级执行（APR 寄存器中的值），则使用仲裁优先级（Arb ID 寄存器中的唯一值）来打破平局。APR 的所有 8 位都用于最低优先级仲裁。

### 8.10.1. 总线消息格式
有关用于在串行 APIC 总线上传输消息的总线消息格式的描述，请参见附录 F，APIC 总线消息格式。