# EFLAGS寄存器中的系统FLAGS和FIELDS

![](/static/images/2502/p023.png)

EFLAGS寄存器中的系统标志和IOPL字段控制I/O、可屏蔽硬件中断、调试、任务切换和虚拟8086模式（参见图2-3）。只有特权代码（通常是操作系统或executive code（执行程序代码））才应被允许修改这些位。

> Executive code（执行代码）通常是指在操作系统或系统软件中运行在最高权限级别（如特权级别 0）的代码。这类代码负责管理系统的核心功能，例如内存管理、任务调度、中断处理和硬件资源控制等。由于其高权限级别，执行代码可以直接访问和操作系统的关键资源和硬件寄存器。

系统标志和IOPL的功能如下：

**TF 陷阱标志（第8位）**  
设置为启用单步调试模式；清除以禁用单步调试模式。在单步模式下，处理器在每条指令后生成调试异常，从而允许在每条指令后检查程序的执行状态。如果应用程序使用POPF、POPFD或IRET指令设置TF标志，则会在POPF、POPFD或IRET指令之后的指令后生成调试异常。

**IF 中断使能标志（第9位）**  
控制处理器对可屏蔽硬件中断请求的响应（参见第5.3.2节“可屏蔽硬件中断”）。设置为响应可屏蔽硬件中断；清除以禁止可屏蔽硬件中断。IF标志不影响异常或不可屏蔽中断（NMI中断）的生成。CPL、IOPL和控制寄存器CR4中的VME标志的状态决定了CLI、STI、POPF、POPFD和IRET指令是否可以修改IF标志。

**IOPL I/O特权级别字段（第12位和第13位）**  
指示当前运行程序或任务的I/O特权级别（IOPL）。当前运行程序或任务的CPL必须小于或等于IOPL才能访问I/O地址空间。该字段只能在CPL为0时通过POPF和IRET指令修改。有关IOPL与I/O操作关系的更多信息，请参见《IA-32 Intel架构软件开发手册》第1卷第12章“输入/输出”。IOPL也是控制IF标志修改以及在虚拟8086模式下处理中断的机制之一（当虚拟模式扩展生效时，即控制寄存器CR4中的VME标志被设置）。

**NT 嵌套任务标志（第14位）**  
控制中断任务和被调用任务的链接。处理器在通过CALL指令、中断或异常启动的任务调用时设置此标志。它在通过IRET指令返回任务时检查和修改此标志。该标志可以通过POPF/POPFD指令显式设置或清除；然而，更改此标志的状态可能会在应用程序中生成意外异常。有关嵌套任务的更多信息，请参见第6.4节“任务链接”。

**RF 恢复标志（第16位）**  
控制处理器对指令断点条件的响应。设置时，此标志暂时禁止因指令断点生成调试异常（#DE）；尽管其他异常条件仍可能生成异常。清除时，指令断点将生成调试异常。  
RF标志的主要功能是允许在由指令断点条件引起的调试异常后重新启动指令。在这种情况下，调试器软件必须在通过IRETD指令返回到被中断程序之前，在堆栈上的EFLAGS映像中设置此标志，以防止指令断点再次引发调试异常。处理器在成功执行返回的指令后自动清除此标志，从而再次启用指令断点故障。有关此标志使用的更多信息，请参见第15.3.1.1节“指令断点异常条件”。

**VM 虚拟8086模式标志（第17位）**  
设置为启用虚拟8086模式；清除以返回保护模式。有关使用此标志切换到虚拟8086模式的详细描述，请参见第16.2.1节“启用虚拟8086模式”。

**AC 对齐检查标志（第18位）**  
设置此标志和控制寄存器CR0中的AM标志以启用内存引用的对齐检查；清除AC标志和/或AM标志以禁用对齐检查。当引用未对齐的操作数（例如奇数字节地址的字或非4的整数倍地址的双字）时，会生成对齐检查异常。对齐检查异常仅在用户模式（特权级3）下生成。默认特权级为0的内存引用（例如段描述符加载）即使由用户模式下执行的指令引起，也不会生成此异常。  
对齐检查异常可用于检查数据的对齐。这在与其他处理器交换数据时非常有用，因为这些处理器要求所有数据对齐。对齐检查异常还可以由解释器用于通过不对齐指针来标记某些指针为特殊指针。这消除了检查每个指针的开销，仅在特殊指针被使用时处理它。

**VIF 虚拟中断标志（第19位）**  
包含IF标志的虚拟映像。此标志与VIP标志结合使用。处理器仅在控制寄存器CR4中的VME标志或PVI标志被设置且IOPL小于3时识别VIF标志。（VME标志启用虚拟8086模式扩展；PVI标志启用保护模式虚拟中断。）  
有关此标志使用的详细信息，请参见第16.3.3.5节“方法6：软件中断处理”和第16.4节“保护模式虚拟中断”。

**VIP 虚拟中断挂起标志（第20位）**  
由软件设置以指示有中断挂起；清除以指示没有中断挂起。此标志与VIF标志结合使用。处理器读取此标志但从不修改它。处理器仅在控制寄存器CR4中的VME标志或PVI标志被设置且IOPL小于3时识别VIP标志。（VME标志启用虚拟8086模式扩展；PVI标志启用保护模式虚拟中断。）  
有关此标志使用的详细信息，请参见第16.3.3.5节“方法6：软件中断处理”和第16.4节“保护模式虚拟中断”。

**ID 识别标志（第21位）**  
程序或过程设置或清除此标志的能力表明支持CPUID指令。