# VLAN虚拟局域网

https://www.youtube.com/watch?v=ErPumG9PthY

- 交换机是数据链路层的连接设备
- 使用一个或者多个交换机互联起来的交换式以太网，其所有站点都属于同一个广播域
- 随着交换式以太网规模的扩大，广播域响应扩大
- 巨大的广播域并不是一件好事，它会带来很多问题：
  - 产生广播风波
  - 难以管理和维护
  - 潜在的安全问题

![](/static/images/2111/p002.png)

ARP请求是一种广播帧，会传送会网络中的所有主机，浪费网络资源，浪费主机CPU资源

![](/static/images/2111/p003.png)

- 使用TCP/IP协议栈，很多协议都会广播：
  - ARP
  - RIP：路由信息协议（一种小型的，内部路由协议）
  - DHCP：动态主机配置协议（用于自动配置IP地址）

从而需要分割广播域

- 使用路由器可以隔离广播域
  - 路由器成本高

![](/static/images/2111/p004.png)

虚拟局域网VLAN技术应运而生

虚拟局域网VLAN是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求

![](/static/images/2111/p005.png)

![](/static/images/2111/p006.png)

如何实现VLAN

![](/static/images/2111/p007.png)

![](/static/images/2111/p008.png)

- 交换器上生成的各VLAN是互不相同的（广播域）
- 实现VLAN间通信的方法：
  - 使用路由器
  - 使用三层交换器

单个交换机：MAC-端口映射表，VLAN ID-端口映射表（静态记录）

![](/static/images/2111/p009.png)

多个交换机

- 基于IEEE 802.1Q协议实现，对以太网帧格式进行扩展，插入了4字节的VLAN标记（动态记录）
- VLAN标记的最后12位称为VLAN标识符VID，它唯一的标志了以太网帧属于哪一个VLAN
  - VID的取值范围0~4095
  - 0和4095都不用来表示VLAN，因此用于表示VLAN的VID有效取值范围是1~4094
- 802.1Q帧是由交换机来处理的，而不是由用户主机来处理的
  - 当交换机接收到普通的以太网帧时，会将其插入4字节VLAN标记进而转变为802.1Q帧，简称打标签
  - 当交换机转发802.1Q帧时，可能会删除其4字节VLAN标记进而转变为普通的以太网帧，简称去标签

![](/static/images/2111/p010.png)

交换器端口类型

- Access
  - 一般用于连接用户计算机
  - 只能属于一个VLAN
  - PVID值与端口所属VLAN的ID相同
  - 接收处理方法：
    - 一般只接收未打标签的数据帧，即普通以太网数据帧
    - 当接收到未打标签的数据帧时，根据接收该帧的端口的PVID，给帧打标签
  - 发送处理方法：
    - 若帧中的VID与端口的PVID相等，则去除标签并转发该帧，否则不处理
- Trunk
  - 一般用于交换机之间或者交换机与路由器之间的互联
  - trunk端口可以属于多个VLAN
  - 用户可以设置trunk端口的PVID值，默认情况下，trunk端口的PVID值是1
  - 接收处理方法：
    - 接收已打标签的数据帧，而不管数据帧中的VID是否等于端口的PVID
    - 接收未打标签的数据帧，根据端口的PVID值给帧打标签，即插入4字节VLAN ID字段，字段中的VID取值与端口PVID取值相等
  - 发送处理方法：
    - 对于数据帧中的VID等于端口PVID的数据帧，去掉标签再转发
    - 对于数据帧中的VID不等于端口PVID的数据帧，直接转发
- Hybrid
