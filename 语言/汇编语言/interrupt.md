### 中断机制及其工作原理

有时候，程序的正常执行流程需要被打断，以处理需要迅速响应的事件。计算机硬件提供了一种名为**中断（interrupts）**的机制来处理这些事件。例如，当鼠标移动时，鼠标硬件会中断当前程序的执行以处理鼠标移动（如移动鼠标光标等）。中断会将控制权交给**中断处理程序（interrupt handler）**。中断处理程序是用来处理中断的例程。每种类型的中断都分配了一个整数编号。在物理内存的起始位置，有一个**中断向量表（interrupt vector table）**，其中存储了中断处理程序的分段地址。中断号本质上是这个表的索引。

---

### 外部中断和内部中断

#### **外部中断（External Interrupts）**
由 CPU 外部的硬件设备触发，例如：
- 鼠标
- 键盘
- 计时器
- 磁盘驱动器
- CD-ROM 和声卡等 I/O 设备

#### **内部中断（Internal Interrupts）**
由 CPU 内部触发，包括两种类型：
- **错误中断（Traps）**  
  通常由错误引发，例如除零错误。
- **软件中断（Software Interrupts）**  
  由中断指令生成。例如：
  - DOS 使用这些中断来实现其 API（应用程序接口）。
  - 现代操作系统（如 Windows 和 UNIX）使用基于 C 的接口。

---

### 中断处理过程

1. **常规中断**  
   大多数中断处理程序在完成后会将控制权交还给被中断的程序：
   - 恢复所有寄存器的值为中断发生前的状态。
   - 被中断的程序会像什么都没发生一样继续运行（除了损失了一些 CPU 周期）。

2. **错误中断（Traps）**  
   **Trap** 通常不会返回，常用于终止程序的执行。

---

### 虚拟内存与现代中断

在现代系统中：
- 外部设备和操作系统使用中断高效地管理资源。
- DOS 使用软件中断实现其 API，而现代操作系统（如 Windows 和 UNIX）则通过基于 C 的接口处理事件。