## real mode

在实模式下，内存被限制到了1MB（2^20ytes）。合法的地址区间是0x00000~0xFFFFF。

对于8086，找不到一个20bit的寄存器，所以需要两个16bit的寄存器来表示地址。

这两个寄存器分别表示为selector和offset，地址计算方法是：

16*selector + offset

其中

- selector可能是CS/DS/SS/ES等
- offset可能是数据寄存器(BX/SI/DI)、指针寄存器(SP/BP)、IP等。

该模式的缺点：

- 内存地址表示不唯一
- A single selector value can only reference 64K of memory (the upper limit of the 16-bit offset).

对第二个缺点的理解：

在8086模式中，每个selector所能引用的内存空间是有限制的，由于offset是16位的，因此一个selector最多只能引用64KB的内存。

在8086实模式中，内存是通过segment来组织的，每个segment的大小是64KB；offset是指segment内的地址。

每个selector能否访问的内存区域最大是64KB，即它可以引用一个从0x0000到0xFFFF的偏移地址。

selector决定了段的起始位置

## 16bit保护模式

在 80286 的 16 位保护模式下，选择子（selector）值的解释方式与实模式完全不同。在实模式中，选择子值是物理内存的段落号。在保护模式下，选择子值是描述符表中的索引。在这两种模式下，程序都被划分为段。在实模式下，这些段位于物理内存的固定位置，选择子值表示段开始的段落号。在保护模式下，段不再位于物理内存中的固定位置。实际上，它们甚至不需要在内存中！

保护模式使用一种称为虚拟内存的技术。虚拟内存系统的基本思想是，只将程序当前正在使用的data和code保存在内存中。其他data和code则暂时存储在磁盘上，直到它们再次需要时才会被加载到内存中。在 16 位保护模式下，segment会根据需要在内存和磁盘之间移动。当一个段从磁盘返回内存时，很可能它会被放置到内存中的一个不同区域，而不是它被移动到磁盘之前所在的位置。所有这些操作都由操作系统透明地完成，程序不需要为虚拟内存的工作做任何修改。

在保护模式下，每个段都有一个在描述符表中的条目。这个条目包含了系统需要了解的关于该段的所有信息。这些信息包括：该段是否当前在内存中；如果在内存中，它的位置在哪里；访问权限（例如只读）。该段条目的索引就是存储在段寄存器中的选择子值。

## 32bit保护模式

386相对于286的主要区别：

- offset被扩展到32bit，这样segment可以有4GB的大小
- segment可以被分为4KB大小的单元，叫做page。
    - 虚拟内存系统不再操作segment，而是操作的page；这意味着segment中可以只有1部分被放在内存中
    - 在286模式下，segment要么都在内存中，要么都不在，而这对于32bit模式的大segment是不合理的